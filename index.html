<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actor Release Form - Electronic Signature</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f4f4f4;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #007bff;
            padding-bottom: 20px;
        }

        .header h1 {
            color: #007bff;
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .contract-section {
            margin-bottom: 30px;
        }

        .contract-section h2 {
            color: #007bff;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .contract-text {
            background-color: #f8f9fa;
            padding: 20px;
            border-left: 4px solid #007bff;
            margin-bottom: 20px;
            font-size: 0.95em;
            line-height: 1.7;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #007bff;
        }

        .signature-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 2px dashed #007bff;
        }

        .signature-canvas {
            border: 2px solid #007bff;
            border-radius: 4px;
            cursor: crosshair;
            background-color: white;
            display: block;
            margin: 10px auto;
            touch-action: none;
            width: 700px;
            height: 200px;
        }

        .signature-controls {
            text-align: center;
            margin-top: 15px;
        }

        .btn {
            padding: 12px 24px;
            margin: 0 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #545b62;
        }

        .btn-success {
            background-color: #28a745;
            color: white;
            font-size: 18px;
            padding: 15px 30px;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .error-message {
            color: #dc3545;
            font-weight: 600;
            margin-top: 10px;
            display: none;
        }

        .success-message {
            color: #28a745;
            font-weight: 600;
            margin-top: 10px;
            display: none;
        }

        .required {
            color: #dc3545;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .signature-canvas {
                width: 100%;
                height: 150px;
            }
            
            .btn {
                display: block;
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ACTOR RELEASE FORM FOR PROMOTIONAL VIDEOS</h1>
            <p>Electronic Signature Document</p>
        </div>

        <div class="contract-section">
            <h2>ACTOR RELEASE FORM FOR PROMOTIONAL VIDEOS</h2>
            <div class="contract-text">
                <p>This Actor Release Form ("Release") is entered into on the date signed below between Mastermind Alliance Group, Inc,("Company") located at 1606 N Carver St, Greensburg, IN 47240-9353 ("Company Address"), and the Actor signing below.</p>
                
                <p><strong>WHEREAS,</strong> the Company has engaged the Actor to appear and perform in eight (8) promotional video productions (collectively, the "Videos"), including one (1) introductory video titled Mastermind Alliance Intro and seven (7) additional videos, each introducing and promoting one of the "7 Pillars of Society" (collectively, the "Promotional Content"), which are to be produced and distributed by or on behalf of Mastermind Alliance Group Inc.; and</p>
                
                <p><strong>WHEREAS,</strong> the Actor acknowledges receipt of full and adequate consideration for their performance in connection with the Videos, and hereby irrevocably assigns, transfers, and conveys to the Company all rights, title, and interest, including all intellectual property and publicity rights, in and to the Videos and the Promotional Content, in perpetuity and throughout the universe, for any and all uses now known or hereafter devised. The Actor further waives any and all claims to ownership, royalties, or additional compensation, and acknowledges that no further payment shall be due or payable in the future for such services or rights assigned herein.</p>
                
                <p><strong>NOW, THEREFORE,</strong> for good and valuable consideration, the receipt and sufficiency of which are hereby acknowledged, the parties agree as follows:</p>
                
                <p><strong>• Grant of Rights:</strong> Actor hereby irrevocably assigns, transfers, and conveys to Company all rights, title, and interest in and to the Videos, including but not limited to Actor's performance, likeness, voice, and any other contributions therein. This grant includes all rights for commercial, advertising, business, and personal use, in perpetuity, worldwide, across all media now known or hereafter devised, including but not limited to television, internet, social media, print, and digital platforms.</p>
                
                <p><strong>• Scope of Use:</strong> Company shall have the unlimited right to edit, reproduce, distribute, display, perform, create derivative works from, and otherwise exploit the Videos for any purpose, including but not limited to marketing, promotion, advertising, and personal projects, without any further obligation to Actor.</p>
                
                <p><strong>• Release and Waiver:</strong> Actor hereby releases Company, its affiliates, successors, assigns, and licensees from any and all claims, demands, or causes of action arising out of or related to the use of the Videos, including but not limited to claims for compensation, royalties, defamation, invasion of privacy, right of publicity, or intellectual property infringement. Actor acknowledges that they hold no claim to ownership of the Videos or any derivative works created therefrom.</p>
                
                <p><strong>• Compensation:</strong> Actor acknowledges that they have been paid in full for their performance in the Videos and that no further compensation, monetary or otherwise, will be provided at any time in the future for their performance or for the rights granted herein.</p>
                
                <p><strong>• Representations and Warranties:</strong> Actor represents and warrants that:</p>
                <ul style="margin: 10px 0 10px 20px;">
                    <li>They are of legal age and have the full right and authority to enter into this Release.</li>
                    <li>Their performance in the Videos does not infringe upon the rights of any third party.</li>
                    <li>They have not granted any rights to any third party that would conflict with the rights assigned herein.</li>
                </ul>
                
                <p><strong>• Governing Law:</strong> This Release shall be governed by and construed in accordance with the laws of the State of Indiana. Any disputes arising under this Release shall be resolved in the courts of the State of Indiana.</p>
                
                <p><strong>• Entire Agreement:</strong> This Release constitutes the entire agreement between the parties and supersedes all prior negotiations or agreements, whether written or oral. This Release may not be amended except in writing signed by both parties.</p>
                
                <p><strong>IN WITNESS WHEREOF,</strong> the Actor has executed this Release as of the date signed below.</p>
            </div>
        </div>

        <form id="releaseForm">
            <div class="form-group">
                <label for="fullName">Full Legal Name <span class="required">*</span></label>
                <input type="text" id="fullName" name="fullName" required placeholder="Enter your full legal name">
            </div>

            <div class="form-group">
                <label for="email">Email Address <span class="required">*</span></label>
                <input type="email" id="email" name="email" required placeholder="Enter your email address">
            </div>

            <div class="form-group">
                <label for="date">Date <span class="required">*</span></label>
                <input type="date" id="date" name="date" required>
            </div>

            <div class="signature-section">
                <h2>Electronic Signature</h2>
                <label for="signatureCanvas">Please sign below using your mouse, trackpad, or finger <span class="required">*</span></label>
                <canvas id="signatureCanvas" class="signature-canvas" width="700" height="200"></canvas>
                <div class="signature-controls">
                    <button type="button" id="clearSignature" class="btn btn-secondary">Clear Signature</button>
                    <button type="button" id="undoSignature" class="btn btn-secondary">Undo Last Stroke</button>
                </div>
            </div>

            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>

            <div style="text-align: center; margin-top: 30px;">
                <button type="submit" id="submitForm" class="btn btn-success">Sign and Submit</button>
            </div>
        </form>
    </div>

    <script>
        class SignaturePad {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.isDrawing = false;
                this.strokes = [];
                this.currentStroke = [];
                
                this.setupCanvas();
                this.bindEvents();
            }

            setupCanvas() {
                // Get the actual displayed size
                const rect = this.canvas.getBoundingClientRect();
                
                // Set canvas internal size to match display size
                this.canvas.width = rect.width;
                this.canvas.height = rect.height;
                
                // Set drawing style
                this.ctx.strokeStyle = '#000';
                this.ctx.lineWidth = 2;
                this.ctx.lineCap = 'round';
                this.ctx.lineJoin = 'round';
                
                // Clear any existing drawings
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            }

            bindEvents() {
                // Mouse events
                this.canvas.addEventListener('mousedown', this.startDrawing.bind(this));
                this.canvas.addEventListener('mousemove', this.draw.bind(this));
                this.canvas.addEventListener('mouseup', this.stopDrawing.bind(this));
                this.canvas.addEventListener('mouseout', this.stopDrawing.bind(this));

                // Touch events for mobile
                this.canvas.addEventListener('touchstart', this.handleTouch.bind(this));
                this.canvas.addEventListener('touchmove', this.handleTouch.bind(this));
                this.canvas.addEventListener('touchend', this.stopDrawing.bind(this));
            }

            getEventPos(e) {
                const rect = this.canvas.getBoundingClientRect();
                const scaleX = this.canvas.width / rect.width;
                const scaleY = this.canvas.height / rect.height;
                
                return {
                    x: (e.clientX - rect.left) * scaleX,
                    y: (e.clientY - rect.top) * scaleY
                };
            }

            handleTouch(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                    e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                
                if (e.type === 'touchstart') this.startDrawing(mouseEvent);
                else if (e.type === 'touchmove') this.draw(mouseEvent);
            }

            startDrawing(e) {
                this.isDrawing = true;
                this.currentStroke = [this.getEventPos(e)];
                this.ctx.beginPath();
                this.ctx.moveTo(this.currentStroke[0].x, this.currentStroke[0].y);
            }

            draw(e) {
                if (!this.isDrawing) return;
                
                const pos = this.getEventPos(e);
                this.currentStroke.push(pos);
                
                this.ctx.lineTo(pos.x, pos.y);
                this.ctx.stroke();
            }

            stopDrawing() {
                if (this.isDrawing) {
                    this.isDrawing = false;
                    this.strokes.push([...this.currentStroke]);
                    this.currentStroke = [];
                }
            }

            clear() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.strokes = [];
            }

            undo() {
                if (this.strokes.length > 0) {
                    this.strokes.pop();
                    this.redraw();
                }
            }

            redraw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.strokes.forEach(stroke => {
                    if (stroke.length > 0) {
                        this.ctx.beginPath();
                        this.ctx.moveTo(stroke[0].x, stroke[0].y);
                        
                        stroke.forEach(point => {
                            this.ctx.lineTo(point.x, point.y);
                        });
                        
                        this.ctx.stroke();
                    }
                });
            }

            isEmpty() {
                return this.strokes.length === 0;
            }

            getDataURL() {
                return this.canvas.toDataURL();
            }
        }

        // Initialize signature pad
        const canvas = document.getElementById('signatureCanvas');
        const signaturePad = new SignaturePad(canvas);

        // Button event listeners
        document.getElementById('clearSignature').addEventListener('click', () => {
            signaturePad.clear();
        });

        document.getElementById('undoSignature').addEventListener('click', () => {
            signaturePad.undo();
        });

        // Set today's date as default
        document.getElementById('date').valueAsDate = new Date();

        // Form submission
        document.getElementById('releaseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            
            // Hide previous messages
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            
            // Validate form
            const fullName = document.getElementById('fullName').value.trim();
            const email = document.getElementById('email').value.trim();
            const date = document.getElementById('date').value;
            
            if (!fullName || !email || !date) {
                errorMessage.textContent = 'Please fill in all required fields.';
                errorMessage.style.display = 'block';
                return;
            }
            
            if (signaturePad.isEmpty()) {
                errorMessage.textContent = 'Please provide your signature.';
                errorMessage.style.display = 'block';
                return;
            }
            
            // Generate and submit PDF
            try {
                await submitSignedDocument(fullName, email, date, signaturePad.getDataURL());
                successMessage.textContent = 'Document signed and submitted successfully! You will receive a confirmation email shortly.';
                successMessage.style.display = 'block';
                
                // Clear the form after successful submission
                document.getElementById('releaseForm').reset();
                signaturePad.clear();
            } catch (error) {
                console.error('Document submission error:', error);
                
                // If email submission fails, offer local download as fallback
                if (error.message.includes('Email service not configured') || error.message.includes('500')) {
                    errorMessage.textContent = 'Email service not configured. Downloading PDF locally instead...';
                    errorMessage.style.display = 'block';
                    
                    // Generate and download PDF locally
                    try {
                        const pdfBase64 = await generatePDFBase64(fullName, email, date, signaturePad.getDataURL());
                        const pdfBlob = new Blob([Uint8Array.from(atob(pdfBase64), c => c.charCodeAt(0))], {type: 'application/pdf'});
                        const url = URL.createObjectURL(pdfBlob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `Mastermind_Alliance_Actor_Release_${fullName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                        a.click();
                        URL.revokeObjectURL(url);
                        
                        successMessage.textContent = 'Document signed and downloaded! Please email it manually.';
                        successMessage.style.display = 'block';
                        errorMessage.style.display = 'none';
                        
                        document.getElementById('releaseForm').reset();
                        signaturePad.clear();
                    } catch (downloadError) {
                        errorMessage.textContent = 'Error generating document. Please try again.';
                    }
                } else {
                    errorMessage.textContent = `Error submitting document: ${error.message}`;
                    errorMessage.style.display = 'block';
                }
            }
        });

        async function submitSignedDocument(fullName, email, date, signatureDataURL) {
            console.log('🚀 Starting document submission...');
            
            // Generate PDF
            console.log('📄 Generating PDF...');
            const pdfBase64 = await generatePDFBase64(fullName, email, date, signatureDataURL);
            console.log('✅ PDF generated, length:', pdfBase64.length);
            
            // Submit to backend
            console.log('📤 Submitting to server...');
            const response = await fetch('/api/submit-document', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    fullName,
                    email,
                    date,
                    signatureDataURL,
                    pdfBase64,
                    timestamp: new Date().toISOString()
                })
            });
            
            console.log('📡 Response status:', response.status);
            console.log('📡 Response ok:', response.ok);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('❌ Server response:', errorText);
                throw new Error(`Submission failed: ${response.status} - ${errorText}`);
            }
            
            const result = await response.json();
            console.log('✅ Submission successful:', result);
            return result;
        }

        async function generatePDFBase64(fullName, email, date, signatureDataURL) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Set font
            doc.setFont('helvetica');
            
            // Header
            doc.setFontSize(20);
            doc.setTextColor(0, 123, 255);
            doc.text('ACTOR RELEASE FORM FOR PROMOTIONAL VIDEOS', 105, 25, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text('Electronic Signature Document', 105, 35, { align: 'center' });
            
            // Contract text
            doc.setFontSize(14);
            doc.setTextColor(0, 123, 255);
            doc.text('ACTOR RELEASE FORM FOR PROMOTIONAL VIDEOS', 20, 50);
            
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            
            const contractText = [
                'ACTOR RELEASE FORM FOR PROMOTIONAL VIDEOS',
                '',
                'This Actor Release Form ("Release") is entered into on the date signed below',
                'between Mastermind Alliance Group, Inc,("Company") located at 1606 N Carver St,',
                'Greensburg, IN 47240-9353 ("Company Address"), and the Actor signing below.',
                '',
                'WHEREAS, the Company has engaged the Actor to appear and perform in eight (8)',
                'promotional video productions (collectively, the "Videos"), including one (1)',
                'introductory video titled Mastermind Alliance Intro and seven (7) additional videos,',
                'each introducing and promoting one of the "7 Pillars of Society" (collectively, the',
                '"Promotional Content"), which are to be produced and distributed by or on behalf',
                'of Mastermind Alliance Group Inc.; and',
                '',
                'WHEREAS, the Actor acknowledges receipt of full and adequate consideration for',
                'their performance in connection with the Videos, and hereby irrevocably assigns,',
                'transfers, and conveys to the Company all rights, title, and interest, including all',
                'intellectual property and publicity rights, in and to the Videos and the Promotional',
                'Content, in perpetuity and throughout the universe, for any and all uses now known',
                'or hereafter devised. The Actor further waives any and all claims to ownership,',
                'royalties, or additional compensation, and acknowledges that no further payment',
                'shall be due or payable in the future for such services or rights assigned herein.',
                '',
                'NOW, THEREFORE, for good and valuable consideration, the receipt and sufficiency',
                'of which are hereby acknowledged, the parties agree as follows:',
                '',
                '• Grant of Rights: Actor hereby irrevocably assigns, transfers, and conveys to',
                'Company all rights, title, and interest in and to the Videos, including but not',
                'limited to Actor\'s performance, likeness, voice, and any other contributions therein.',
                'This grant includes all rights for commercial, advertising, business, and personal',
                'use, in perpetuity, worldwide, across all media now known or hereafter devised,',
                'including but not limited to television, internet, social media, print, and digital',
                'platforms.',
                '',
                '• Scope of Use: Company shall have the unlimited right to edit, reproduce,',
                'distribute, display, perform, create derivative works from, and otherwise exploit',
                'the Videos for any purpose, including but not limited to marketing, promotion,',
                'advertising, and personal projects, without any further obligation to Actor.',
                '',
                '• Release and Waiver: Actor hereby releases Company, its affiliates, successors,',
                'assigns, and licensees from any and all claims, demands, or causes of action',
                'arising out of or related to the use of the Videos, including but not limited to',
                'claims for compensation, royalties, defamation, invasion of privacy, right of',
                'publicity, or intellectual property infringement. Actor acknowledges that they',
                'hold no claim to ownership of the Videos or any derivative works created therefrom.',
                '',
                '• Compensation: Actor acknowledges that they have been paid in full for their',
                'performance in the Videos and that no further compensation, monetary or otherwise,',
                'will be provided at any time in the future for their performance or for the rights',
                'granted herein.',
                '',
                '• Representations and Warranties: Actor represents and warrants that:',
                '  - They are of legal age and have the full right and authority to enter into',
                '    this Release.',
                '  - Their performance in the Videos does not infringe upon the rights of any',
                '    third party.',
                '  - They have not granted any rights to any third party that would conflict with',
                '    the rights assigned herein.',
                '',
                '• Governing Law: This Release shall be governed by and construed in accordance',
                'with the laws of the State of Indiana. Any disputes arising under this Release',
                'shall be resolved in the courts of the State of Indiana.',
                '',
                '• Entire Agreement: This Release constitutes the entire agreement between the',
                'parties and supersedes all prior negotiations or agreements, whether written or',
                'oral. This Release may not be amended except in writing signed by both parties.',
                '',
                'IN WITNESS WHEREOF, the Actor has executed this Release as of the date',
                'signed below.'
            ];
            
            let yPosition = 60;
            contractText.forEach(line => {
                if (line.startsWith('ACTOR RELEASE') || line.startsWith('GRANT OF RIGHTS') || 
                    line.startsWith('WAIVER OF CLAIMS') || line.startsWith('COMPENSATION') || 
                    line.startsWith('BINDING AGREEMENT')) {
                    doc.setFont('helvetica', 'bold');
                } else {
                    doc.setFont('helvetica', 'normal');
                }
                
                doc.text(line, 20, yPosition);
                yPosition += 5;
                
                if (yPosition > 270) {
                    doc.addPage();
                    yPosition = 20;
                }
            });
            
            // Add new page for signature section
            doc.addPage();
            
            // Signature section
            doc.setFontSize(14);
            doc.setTextColor(0, 123, 255);
            doc.text('SIGNATURE SECTION', 20, 30);
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            // Form fields
            doc.text(`Full Name: ${fullName}`, 20, 50);
            doc.text(`Email: ${email}`, 20, 65);
            doc.text(`Date: ${new Date(date).toLocaleDateString()}`, 20, 80);
            
            // Signature
            doc.text('Electronic Signature:', 20, 100);
            
            // Add signature image synchronously
            doc.addImage(signatureDataURL, 'PNG', 20, 110, 100, 30);
            
            // Add timestamp
            doc.setFontSize(8);
            doc.setTextColor(128, 128, 128);
            doc.text(`Document electronically signed on ${new Date().toLocaleString()}`, 20, 280);
            
            // Return base64 instead of saving
            return doc.output('datauristring').split(',')[1];
        }

        // Responsive canvas resize
        window.addEventListener('resize', () => {
            signaturePad.setupCanvas();
            signaturePad.redraw();
        });
    </script>
</body>
</html>